import{__awaiter as e,__spreadArray as t,__decorate as i,__generator as o}from"../../_virtual/_tslib.js";import{action as r,observable as d,computed as n}from"mobx";import*as l from"lodash";var s,u,a,v=["tr","de","en","it","es","fr","ru"],p=function(){function p(e){this._initialized=!1,this._currentLocale=e.currentLocale,this.init()}return p.prototype.init=function(){return e(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.getAddressFormCountrySettings()];case 1:return e.sent(),[4,this.getAddressFormCountryLabels()];case 2:return e.sent(),this._initialized=!0,[2]}}))}))},Object.defineProperty(p.prototype,"initialized",{get:function(){return this._initialized},enumerable:!1,configurable:!0}),p.prototype.waitUntilInitialized=function(){var e=this;return new Promise((function(t){var i=setInterval((function(){e.initialized&&(clearInterval(i),t(null))}),100)}))},p.prototype.getFieldSettings=function(e){var t,i,o,r,d,n,l,s,v,p,g,c,y,m,h,F,b,f,A,N,L,S,x,C,T,E,_,O,V,I,R,B,q,D,w,M,z,P,U,Y,j,X=e.country,k=e.invisibleAddressFields,G=void 0===k?[]:k,H=e.invisibleBillingFields,W=void 0===H?[]:H,$=e.validateAddressForm,J=void 0===$||$,K=e.validateBillingForm,Q=void 0!==K&&K,Z=e.customAddressFormSettings,ee=void 0===Z?{}:Z,te=this.getCountrySettings(X);if(te){var ie=te.fields,oe=this.getAddressFormat(X),re=this.getBillingFormat(X);return{firstName:this.getAddressFormSetting(!0,null===(t=ie.firstName)||void 0===t?void 0:t.type,null===(i=ie.firstName)||void 0===i?void 0:i.regex,u.FIRSTNAME,oe,G,J,null==ee?void 0:ee.firstName),lastName:this.getAddressFormSetting(!0,null===(o=ie.lastName)||void 0===o?void 0:o.type,null===(r=ie.lastName)||void 0===r?void 0:r.regex,u.LASTNAME,oe,G,J,null==ee?void 0:ee.lastName),identityNumber:this.getAddressFormSetting(null===(d=ie.identityNumber)||void 0===d?void 0:d.required,null===(n=ie.identityNumber)||void 0===n?void 0:n.type,null===(l=ie.identityNumber)||void 0===l?void 0:l.regex,u.IDENTITY_NUMBER,oe,G,J,null==ee?void 0:ee.identityNumber),addressLine1:this.getAddressFormSetting(!0,null===(s=ie.addressLine1)||void 0===s?void 0:s.type,null===(v=ie.addressLine1)||void 0===v?void 0:v.regex,u.ADDRESS_LINE_1,oe,G,J,null==ee?void 0:ee.addressLine1),addressLine2:this.getAddressFormSetting(null===(p=ie.addressLine2)||void 0===p?void 0:p.required,null===(g=ie.addressLine2)||void 0===g?void 0:g.type,null===(c=ie.addressLine2)||void 0===c?void 0:c.regex,u.ADDRESS_LINE_2,oe,G,J,null==ee?void 0:ee.addressLine2),postalCode:this.getAddressFormSetting(null===(y=ie.postalCode)||void 0===y?void 0:y.required,null===(m=ie.postalCode)||void 0===m?void 0:m.type,null===(h=ie.postalCode)||void 0===h?void 0:h.regex,u.POSTAL_CODE,oe,G,J,null==ee?void 0:ee.postalCode),country:this.getAddressFormSetting(!0,null===(F=ie.country)||void 0===F?void 0:F.type,null===(b=ie.country)||void 0===b?void 0:b.regex,u.COUNTRY,oe,G,J,null==ee?void 0:ee.country),state:this.getAddressFormSetting(null===(f=ie.state)||void 0===f?void 0:f.required,null===(A=ie.state)||void 0===A?void 0:A.type,null===(N=ie.state)||void 0===N?void 0:N.regex,u.STATE,oe,G,J,null==ee?void 0:ee.state),city:this.getAddressFormSetting(null===(L=ie.city)||void 0===L?void 0:L.required,null===(S=ie.city)||void 0===S?void 0:S.type,null===(x=ie.city)||void 0===x?void 0:x.regex,u.CITY,oe,G,J,null==ee?void 0:ee.city),district:this.getAddressFormSetting(null===(C=ie.district)||void 0===C?void 0:C.required,null===(T=ie.district)||void 0===T?void 0:T.type,null===(E=ie.district)||void 0===E?void 0:E.regex,u.DISTRICT,oe,G,J,null==ee?void 0:ee.district),region:this.getAddressFormSetting(null===(_=ie.region)||void 0===_?void 0:_.required,null===(O=ie.region)||void 0===O?void 0:O.type,null===(V=ie.region)||void 0===V?void 0:V.regex,u.REGION,oe,G,J,null==ee?void 0:ee.region),phone:this.getAddressFormSetting(null===(I=ie.phone)||void 0===I?void 0:I.required,null===(R=ie.phone)||void 0===R?void 0:R.type,(null===(B=ie.phone)||void 0===B?void 0:B.regex)||/^\+?\d{10,}$/,u.PHONE,oe,G,J,null==ee?void 0:ee.phone),company:this.getBillingFormSetting(null===(q=ie.company)||void 0===q?void 0:q.required,null===(D=ie.company)||void 0===D?void 0:D.type,null===(w=ie.company)||void 0===w?void 0:w.regex,a.COMPANY,re,W,Q,null==ee?void 0:ee.company),taxOffice:this.getBillingFormSetting(null===(M=ie.taxOffice)||void 0===M?void 0:M.required,null===(z=ie.taxOffice)||void 0===z?void 0:z.type,null===(P=ie.taxOffice)||void 0===P?void 0:P.regex,a.TAX_OFFICE,re,W,Q,null==ee?void 0:ee.taxOffice),taxNumber:this.getBillingFormSetting(null===(U=ie.taxNumber)||void 0===U?void 0:U.required,null===(Y=ie.taxNumber)||void 0===Y?void 0:Y.type,null===(j=ie.taxNumber)||void 0===j?void 0:j.regex,a.TAX_NUMBER,re,W,Q,null==ee?void 0:ee.taxNumber)}}},p.prototype.getFieldLabels=function(e){var t,i,o,r,d,n,l,s,u,a,v,p,g,c,y,m,h,F,b,f,A,N,L,S,x,C,T,E,_=this.getCountryLabels(e);if(_){var O=_.fields;return{firstName:this.getAddressFormLabel(null===(t=O.firstName)||void 0===t?void 0:t.label,null===(i=O.firstName)||void 0===i?void 0:i.placeholder),lastName:this.getAddressFormLabel(null===(o=O.lastName)||void 0===o?void 0:o.label,null===(r=O.lastName)||void 0===r?void 0:r.placeholder),identityNumber:this.getAddressFormLabel(null===(d=O.identityNumber)||void 0===d?void 0:d.label,null===(n=O.identityNumber)||void 0===n?void 0:n.placeholder),addressLine1:this.getAddressFormLabel(null===(l=O.addressLine1)||void 0===l?void 0:l.label,null===(s=O.addressLine1)||void 0===s?void 0:s.placeholder),addressLine2:this.getAddressFormLabel(null===(u=O.addressLine2)||void 0===u?void 0:u.label,null===(a=O.addressLine2)||void 0===a?void 0:a.placeholder),postalCode:this.getAddressFormLabel(null===(v=O.postalCode)||void 0===v?void 0:v.label,null===(p=O.postalCode)||void 0===p?void 0:p.placeholder),country:this.getAddressFormLabel(null===(g=O.country)||void 0===g?void 0:g.label,null===(c=O.country)||void 0===c?void 0:c.placeholder),state:this.getAddressFormLabel(null===(y=O.state)||void 0===y?void 0:y.label,null===(m=O.state)||void 0===m?void 0:m.placeholder),city:this.getAddressFormLabel(null===(h=O.city)||void 0===h?void 0:h.label,null===(F=O.city)||void 0===F?void 0:F.placeholder),district:this.getAddressFormLabel(null===(b=O.district)||void 0===b?void 0:b.label,null===(f=O.district)||void 0===f?void 0:f.placeholder),phone:this.getAddressFormLabel(null===(A=O.phone)||void 0===A?void 0:A.label,null===(N=O.phone)||void 0===N?void 0:N.placeholder),company:this.getAddressFormLabel(null===(L=O.company)||void 0===L?void 0:L.label,null===(S=O.company)||void 0===S?void 0:S.placeholder),taxOffice:this.getAddressFormLabel(null===(x=O.taxOffice)||void 0===x?void 0:x.label,null===(C=O.taxOffice)||void 0===C?void 0:C.placeholder),taxNumber:this.getAddressFormLabel(null===(T=O.taxNumber)||void 0===T?void 0:T.label,null===(E=O.taxNumber)||void 0===E?void 0:E.placeholder)}}},p.prototype.getAddressFormat=function(e,t){var i=this.getCountrySettings(e),o=this.getAddressFormatView(i.addressFormat),r=[];return o&&t&&t.length&&o.map((function(e){return l.difference(e,t)})).map((function(e){e.length>0&&r.push(e)})),t&&t.length?r:o},p.prototype.getBillingFormat=function(e,t){var i=this.getCountrySettings(e),o=this.getBillingFormatView(i.billingFormat),r=[];return o&&t&&t.length&&o.map((function(e){return l.difference(e,t)})).map((function(e){e.length>0&&r.push(e)})),t&&t.length?r:o},p.prototype.getAddressFormatIgnoreCountry=function(e,i){return this.getAddressFormat(e,t(t([],i||[],!0),[u.COUNTRY],!1))},p.prototype.getValidationResult=function(e){var t=e.address,i=e.country,o=e.invisibleAddressFields,r=e.invisibleBillingFields,d=e.validateAddressForm,n=e.validateBillingForm,l=e.customAddressFormSettings,s=this.getFieldSettings({country:i,invisibleAddressFields:o,invisibleBillingFields:r,validateAddressForm:d,validateBillingForm:n,customAddressFormSettings:l});if(s)return{firstName:this.isValidField(t.firstName||"",s.firstName),lastName:this.isValidField(t.lastName||"",s.lastName),identityNumber:this.isValidField(t.identityNumber||"",s.identityNumber),addressLine1:this.isValidField(t.addressLine1||"",s.addressLine1),addressLine2:this.isValidField(t.addressLine2||"",s.addressLine2),postalCode:this.isValidField(t.postalCode||"",s.postalCode),country:this.isValidField(t.country||"",s.country),state:this.isValidField(t.state||"",s.state),city:this.isValidField(t.city||"",s.city),district:this.isValidField(t.district||"",s.district),region:this.isValidField(t.region||"",s.region),phone:this.isValidField(t.phone||"",s.phone),company:this.isValidField(t.company||"",s.company),taxOffice:this.isValidField(t.taxOffice||"",s.taxOffice),taxNumber:this.isValidField(t.taxNumber||"",s.taxNumber)}},p.prototype.isValidAddress=function(e){var t=this.getValidationResult(e);return!!t&&Object.values(t).every((function(e){return!e.hasError}))},p.prototype.isValidField=function(e,t){var i=!1,o=!1,r=t.required||!1,d=t.regex||!1;return r&&!d&&(o=!e),r&&d&&(o=!e,i=!this.validateByRegexString(e,t.regex)),!r&&d&&e&&(i=!this.validateByRegexString(e,t.regex)),{hasError:i||o,isInvalid:i,isEmpty:o}},p.prototype.isFreeTextCity=function(e){var t=this.getFieldSettings({country:e});return t&&t.city&&t.city.type===s.TEXT},p.prototype.isFreeTextDistrict=function(e){var t=this.getFieldSettings({country:e});return t&&t.district&&t.district.type===s.TEXT},p.prototype.getCountrySettings=function(e){return this._addressFormCountrySettings.countrySettings[e]},p.prototype.getCountryLabels=function(e){return this._addressFormCountryLabels.countryLabels[e]},p.prototype.getAddressFormatView=function(e){return this._addressFormCountrySettings.addressFormats[e]},p.prototype.getBillingFormatView=function(e){return this._addressFormCountrySettings.billingFormats[e]},p.prototype.getAddressFormCountrySettings=function(){return e(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return"https://cdn.myikas.com/sf/static/location/settings.json",[4,fetch("https://cdn.myikas.com/sf/static/location/settings.json")];case 1:return[4,t.sent().json()];case 2:return e=t.sent(),this._addressFormCountrySettings=e,[2]}}))}))},p.prototype.getAddressFormCountryLabels=function(){return e(this,void 0,void 0,(function(){var e,t,i=this;return o(this,(function(o){switch(o.label){case 0:return v.find((function(e){return e===i._currentLocale}))||(this._currentLocale="en"),e="https://cdn.myikas.com/sf/static/location/".concat(this._currentLocale,".json"),[4,fetch(e)];case 1:return[4,o.sent().json()];case 2:return t=o.sent(),this._addressFormCountryLabels=t,[2]}}))}))},p.prototype.getAddressFormSetting=function(e,t,i,o,r,d,n,l){var s=(d||[]).some((function(e){return e===o}))||!(r||[]).some((function(e){return e.some((function(e){return e===o}))}));return{required:!!n&&(!s&&(void 0===(null==l?void 0:l.required)?e||!1:null==l?void 0:l.required)),type:void 0===(null==l?void 0:l.type)?t:null==l?void 0:l.type,regex:n?s?void 0:void 0===(null==l?void 0:l.regex)?i:null==l?void 0:l.regex:void 0}},p.prototype.getBillingFormSetting=function(e,t,i,o,r,d,n,l){var s=(d||[]).some((function(e){return e===o}))||!(r||[]).some((function(e){return e.some((function(e){return e===o}))}));return{required:!!n&&(!s&&(void 0===(null==l?void 0:l.required)?e||!1:null==l?void 0:l.required)),type:void 0===(null==l?void 0:l.type)?t:null==l?void 0:l.type,regex:n?s?void 0:void 0===(null==l?void 0:l.regex)?i:null==l?void 0:l.regex:void 0}},p.prototype.getAddressFormLabel=function(e,t){return{label:e,placeholder:t}},p.prototype.validateByRegexString=function(e,t){return new RegExp(t).test(e)},i([d],p.prototype,"_initialized",void 0),i([d],p.prototype,"_currentLocale",void 0),i([d],p.prototype,"_addressFormCountrySettings",void 0),i([d],p.prototype,"_addressFormCountryLabels",void 0),i([r.bound],p.prototype,"init",null),i([n],p.prototype,"initialized",null),i([r.bound],p.prototype,"waitUntilInitialized",null),i([r.bound],p.prototype,"getFieldSettings",null),i([r.bound],p.prototype,"getFieldLabels",null),i([r.bound],p.prototype,"getAddressFormat",null),i([r.bound],p.prototype,"getBillingFormat",null),i([r.bound],p.prototype,"getAddressFormatIgnoreCountry",null),i([r.bound],p.prototype,"getValidationResult",null),i([r.bound],p.prototype,"isValidAddress",null),i([r.bound],p.prototype,"isValidField",null),i([r.bound],p.prototype,"isFreeTextCity",null),i([r.bound],p.prototype,"isFreeTextDistrict",null),i([r.bound],p.prototype,"getCountrySettings",null),i([r.bound],p.prototype,"getCountryLabels",null),i([r.bound],p.prototype,"getAddressFormatView",null),i([r.bound],p.prototype,"getBillingFormatView",null),i([r.bound],p.prototype,"getAddressFormCountrySettings",null),i([r.bound],p.prototype,"getAddressFormCountryLabels",null),i([r.bound],p.prototype,"getAddressFormSetting",null),i([r.bound],p.prototype,"getBillingFormSetting",null),i([r.bound],p.prototype,"getAddressFormLabel",null),i([r.bound],p.prototype,"validateByRegexString",null),p}();!function(e){e.TEXT="text",e.DROPDOWN="dropdown"}(s||(s={})),function(e){e.FIRSTNAME="firstName",e.LASTNAME="lastName",e.IDENTITY_NUMBER="identityNumber",e.ADDRESS_LINE_1="addressLine1",e.ADDRESS_LINE_2="addressLine2",e.POSTAL_CODE="postalCode",e.COUNTRY="country",e.STATE="state",e.CITY="city",e.DISTRICT="district",e.REGION="region",e.PHONE="phone"}(u||(u={})),function(e){e.COMPANY="company",e.TAX_OFFICE="taxOffice",e.TAX_NUMBER="taxNumber"}(a||(a={}));export{u as AddressFormItem,a as BillingFormItem,v as COUNTRY_FORMS_LOCALES,s as IkasAddressFormInputType,p as LocalizedAddressModel};

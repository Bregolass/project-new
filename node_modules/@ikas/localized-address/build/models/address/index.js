import{__awaiter as e,__spreadArray as i,__decorate as t,__generator as r}from"../../_virtual/_tslib.js";import{action as s,observable as o,computed as n}from"mobx";import*as l from"lodash";import{AddressFormItem as d,BillingFormItem as a,LocalizedAddressModel as u}from"./model.js";var p=function(){function p(e){this._initialized=!1,this._isErrorsVisible=!1,this._currentLocale=e.currentLocale||"tr",this._currentCountry=e.currentCountry||"TR",this._invisibleAddressFields=e.invisibleAddressFields,this._invisibleBillingFields=e.invisibleBillingFields,this._address={firstName:"",lastName:"",identityNumber:"",addressLine1:"",addressLine2:"",postalCode:"",country:"",state:"",city:"",district:"",phone:"",company:"",taxOffice:"",taxNumber:""},this._validateAddressForm=void 0===e.validateAddressForm||e.validateAddressForm,this._validateBillingForm=void 0!==e.validateBillingForm&&e.validateBillingForm,this._customAddressFormSettings=e.customAddressFormSettings||{},this._message=e.message,this._localizedAddressModel=new u({currentLocale:this._currentLocale}),this.init()}return p.prototype.waitUntilInitialized=function(){var e=this;return new Promise((function(i){var t=setInterval((function(){e.initialized&&(clearInterval(t),i(null))}),100)}))},p.prototype.init=function(){return e(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this._localizedAddressModel.waitUntilInitialized()];case 1:return e.sent(),this._initialized=!0,[2]}}))}))},Object.defineProperty(p.prototype,"initialized",{get:function(){return this._initialized},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"address",{get:function(){return this._address},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isErrorsVisible",{get:function(){return this._isErrorsVisible},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"currentCountry",{get:function(){return this._currentCountry},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"addressFormat",{get:function(){return this._localizedAddressModel.getAddressFormat(this.currentCountry,this._invisibleAddressFields)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"addressFormatIgnoreCountry",{get:function(){return this._localizedAddressModel.getAddressFormatIgnoreCountry(this.currentCountry,this._invisibleAddressFields)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"billingFormat",{get:function(){return this._localizedAddressModel.getBillingFormat(this.currentCountry,this._invisibleBillingFields)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"fieldSettings",{get:function(){return this._localizedAddressModel.getFieldSettings({country:this.currentCountry,invisibleAddressFields:this._invisibleAddressFields,invisibleBillingFields:this._invisibleBillingFields,validateAddressForm:this._validateAddressForm,validateBillingForm:this._validateBillingForm,customAddressFormSettings:this._customAddressFormSettings})},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"fieldLabels",{get:function(){return this._localizedAddressModel.getFieldLabels(this.currentCountry)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isFreeTextCity",{get:function(){return this._localizedAddressModel.isFreeTextCity(this.currentCountry)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isFreeTextDistrict",{get:function(){return this._localizedAddressModel.isFreeTextDistrict(this.currentCountry)},enumerable:!1,configurable:!0}),p.prototype.changeCountry=function(e){this._currentCountry=e},p.prototype.changeAddress=function(e){this._address=e},p.prototype.changeValidateAddressForm=function(e){this._validateAddressForm=e},p.prototype.changeValidateBillingForm=function(e){this._validateBillingForm=e},p.prototype.changeInvisibleAddressFields=function(e){this._invisibleAddressFields=e},p.prototype.changeInvisibleBillingFields=function(e){this._invisibleBillingFields=e},p.prototype.changeCustomAddressFormSettings=function(e){this._customAddressFormSettings=e},p.prototype.validate=function(){this._isErrorsVisible=!0},p.prototype.resetValidate=function(){this._isErrorsVisible=!1},p.prototype.getPostalAddressFormat=function(e){var t=e.countryCode,r=e.address,s=e.isBillingAddress,o=void 0!==s&&s,n=e.identityNumberFormat;if(t){var l=this._localizedAddressModel.getAddressFormat(t,[d.COUNTRY,d.PHONE]),u=this._localizedAddressModel.getBillingFormat(t),p=[],c=[];return i(i([],l,!0),[[d.COUNTRY]],!1).map((function(e){var i=e.map((function(e){return e===d.FIRSTNAME?r.firstName:e===d.LASTNAME?r.lastName:e===d.IDENTITY_NUMBER?n&&r.identityNumber?n(r.identityNumber||""):r.identityNumber:e===d.ADDRESS_LINE_1?r.addressLine1:e===d.ADDRESS_LINE_2?r.addressLine2:e===d.POSTAL_CODE?r.postalCode:e===d.COUNTRY?r.country:e===d.STATE?r.state:e===d.CITY?r.city:e===d.DISTRICT?r.district:e===d.REGION?r.region:null})).join(" ");i&&p.push(i)})),o&&u.map((function(e){var i=e.map((function(e){return e===a.COMPANY?r.company:e===a.TAX_NUMBER?r.taxNumber:e===a.TAX_OFFICE?r.taxOffice:null})).join(" ");i&&c.push(i)})),c.map((function(e,i){p.splice(1+i,0,e)})),p}},Object.defineProperty(p.prototype,"validationResult",{get:function(){var e=this,i=this._localizedAddressModel.getValidationResult({country:this.currentCountry,address:this.address,invisibleAddressFields:this._invisibleAddressFields,invisibleBillingFields:this._invisibleBillingFields,validateAddressForm:this._validateAddressForm,validateBillingForm:this._validateBillingForm,customAddressFormSettings:this._customAddressFormSettings});if(i)return l.mapValues(i,(function(i,t){return{hasError:e._isErrorsVisible&&i.hasError,message:e._isErrorsVisible&&i.hasError?t===d.PHONE?e._message.phoneRule?"string"==typeof e._message.phoneRule?e._message.phoneRule:e._message.phoneRule(t,e.address):"":i.isEmpty?"string"==typeof e._message.requiredRule?e._message.requiredRule:e._message.requiredRule(t,e.address):"string"==typeof e._message.invalidRule?e._message.invalidRule:e._message.invalidRule(t,e.address):""}}))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isValidAddress",{get:function(){return this._localizedAddressModel.isValidAddress({country:this.currentCountry,address:this.address,invisibleAddressFields:this._invisibleAddressFields,invisibleBillingFields:this._invisibleBillingFields,validateAddressForm:this._validateAddressForm,validateBillingForm:this._validateBillingForm,customAddressFormSettings:this._customAddressFormSettings})},enumerable:!1,configurable:!0}),t([o],p.prototype,"_initialized",void 0),t([o],p.prototype,"_currentLocale",void 0),t([o],p.prototype,"_currentCountry",void 0),t([o],p.prototype,"_invisibleAddressFields",void 0),t([o],p.prototype,"_invisibleBillingFields",void 0),t([o],p.prototype,"_address",void 0),t([o],p.prototype,"_validateAddressForm",void 0),t([o],p.prototype,"_validateBillingForm",void 0),t([o],p.prototype,"_customAddressFormSettings",void 0),t([o],p.prototype,"_isErrorsVisible",void 0),t([o],p.prototype,"_message",void 0),t([o],p.prototype,"_localizedAddressModel",void 0),t([s.bound],p.prototype,"waitUntilInitialized",null),t([s.bound],p.prototype,"init",null),t([n],p.prototype,"initialized",null),t([n],p.prototype,"address",null),t([n],p.prototype,"isErrorsVisible",null),t([n],p.prototype,"currentCountry",null),t([n],p.prototype,"addressFormat",null),t([n],p.prototype,"addressFormatIgnoreCountry",null),t([n],p.prototype,"billingFormat",null),t([n],p.prototype,"fieldSettings",null),t([n],p.prototype,"fieldLabels",null),t([n],p.prototype,"isFreeTextCity",null),t([n],p.prototype,"isFreeTextDistrict",null),t([s.bound],p.prototype,"changeCountry",null),t([s.bound],p.prototype,"changeAddress",null),t([s.bound],p.prototype,"changeValidateAddressForm",null),t([s.bound],p.prototype,"changeValidateBillingForm",null),t([s.bound],p.prototype,"changeInvisibleAddressFields",null),t([s.bound],p.prototype,"changeInvisibleBillingFields",null),t([s.bound],p.prototype,"changeCustomAddressFormSettings",null),t([s.bound],p.prototype,"validate",null),t([s.bound],p.prototype,"resetValidate",null),t([s.bound],p.prototype,"getPostalAddressFormat",null),t([n],p.prototype,"validationResult",null),t([n],p.prototype,"isValidAddress",null),p}();export{p as LocalizedAddress};

import{__awaiter as n,__generator as e}from'./../../ext/tslib/tslib.es6.js';import o from"lodash/cloneDeep";import t from"lodash/uniq";import{findAllByKey as s}from"../../utils/helper.js";import"../generators/api/index.js";import{ComponentImportsGenerator as i}from"../generators/components/index.js";import{ConfigGenerator as r}from"../generators/config/index.js";import{PageGenerator as c}from"../generators/pages/index.js";import"../generators/theme/index.js";import{CustomDataTypesGenerator as a}from"../generators/types/index.js";function p(n,e){return!(!n.pages.some((function(n){return!e.pages.find((function(e){return e.id===n.id}))}))&&!e.pages.some((function(e){return!n.pages.find((function(n){return n.id===e.id}))})))||n.pages.some((function(n){var o,i,r=e.pages.find((function(e){return e.id===n.id})),c=n.components;(null===(o=n.specifications)||void 0===o?void 0:o.length)&&n.specifications.forEach((function(n){c.push.apply(c,n.components)}));var a=function(n,e){var o=s(n.propValues,"componentId");o.length&&e.push.apply(e,o)},p=[];c.forEach((function(n){a(n,p)}));var u=(null==r?void 0:r.components)||[];(null===(i=null==r?void 0:r.specifications)||void 0===i?void 0:i.length)&&r.specifications.forEach((function(n){u.push.apply(u,n.components)}));var f=[];u.forEach((function(n){a(n,f)}));var m=t(c.map((function(n){return n.componentId})).concat(p)),l=t(u.map((function(n){return n.componentId})).concat(f)),d=l.some((function(n){return!m.includes(n)})),g=m.some((function(n){return!l.includes(n)}));return!!d||!!g}))}function u(t,s){return n(this,void 0,void 0,(function(){var n,p,u,f,m;return e(this,(function(e){switch(e.label){case 0:return n=o(t),(p={components:[],pages:[],customData:[],name:"",settings:{}}).components=n[0].components,p.customData=n[0].customData,n.forEach((function(n){n.pages.forEach((function(n){var e,o,t=p.pages.find((function(e){return e.type===n.type})),s=t||n;(e=s.components).push.apply(e,n.components),s.specifications||(s.specifications=[]),(o=s.specifications).push.apply(o,n.specifications||[]),t||p.pages.push(s)}))})),[4,i.generate(p,s)];case 1:return(m=e.sent())?[4,c.generate(s)]:[3,3];case 2:m=e.sent(),e.label=3;case 3:return(f=m)?[4,a.generate(p,s)]:[3,5];case 4:f=e.sent(),e.label=5;case 5:return(u=f)?[4,r.generate("prod",s)]:[3,7];case 6:u=e.sent(),e.label=7;case 7:return[2,u]}}))}))}export{u as generate,p as shouldDeploy};

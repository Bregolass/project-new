import{__awaiter as t,__generator as e,__assign as r}from'./../../ext/tslib/tslib.es6.js';import{APIResponse as n}from"@ikas/fe-api-client";import{IkasStorefrontConfig as i}from"@ikas/storefront-config";import{initIkasProduct as a,IkasBrandOrderType as u,IkasCategoryProductsOrderType as o,initIkasProductAttribute as d,initIkasProductOptionSet as l}from"@ikas/storefront-models";function s(r){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,import("../../__api/queries/listProductBackInStockRemind.js")];case 1:return[4,(0,t.sent().default)(r)];case 2:return[2,t.sent()]}}))}))}function c(r){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,import("../../__api/mutations/saveProductBackInStockRemind.js")];case 1:return[4,(0,t.sent().default)(r)];case 2:return[2,t.sent()]}}))}))}function p(u){var o,d;return t(this,void 0,void 0,(function(){var t,l,s,c,p,v;return e(this,(function(e){switch(e.label){case 0:return[4,import("../../__api/queries/searchProducts.js")];case 1:return t=e.sent().default,l=null===(o=i.getCurrentRouting())||void 0===o?void 0:o.dynamicCurrencySettings,c=t,p=[{input:r({locale:i.getCurrentLocale(),dynamicCurrencySettings:l?{roundingFormat:l.roundingFormat,targetCurrencyCode:l.targetCurrencyCode}:void 0},u.input)}],[4,A()];case 2:return[4,c.apply(void 0,p.concat([e.sent()]))];case 3:return s=e.sent(),null==(v=null===(d=s.data)||void 0===d?void 0:d.results.map(C))||v.forEach((function(t){return a(t,i.getCurrentLocale())})),[2,new n(s.data?r(r({},s.data),{data:v}):null,s.graphQLErrors)]}}))}))}function v(r){var i,a;return t(this,void 0,void 0,(function(){var t,u,o;return e(this,(function(e){switch(e.label){case 0:return[4,import("../../__api/queries/getProductFilterData.js")];case 1:return[4,(0,e.sent().default)(r)];case 2:return t=e.sent(),u=null===(i=t.data)||void 0===i?void 0:i.filters,o=(null===(a=t.data)||void 0===a?void 0:a.categories)||null,[2,new n(t.data?{filters:u,categories:o}:null,t.graphQLErrors)]}}))}))}function m(u){var o,d;return t(this,void 0,void 0,(function(){var t,l,s,c;return e(this,(function(e){switch(e.label){case 0:return[4,import("../../__api/queries/getRelatedProducts.js")];case 1:return t=e.sent().default,l=null===(o=i.getCurrentRouting())||void 0===o?void 0:o.dynamicCurrencySettings,[4,t(r({locale:i.getCurrentLocale(),dynamicCurrencySettings:l?{roundingFormat:l.roundingFormat,targetCurrencyCode:l.targetCurrencyCode}:void 0},u))];case 2:return s=e.sent(),(c=(null===(d=null==s?void 0:s.data)||void 0===d?void 0:d.map((function(t){return C(t)})))||[]).forEach((function(t){return a(t,i.getCurrentLocale())})),[2,new n(s.data?{data:c,count:s.data.length,facets:null,limit:20,page:1,totalCount:s.data.length}:null,s.graphQLErrors)]}}))}))}function f(u){var o,d;return t(this,void 0,void 0,(function(){var t,l,s,c;return e(this,(function(e){switch(e.label){case 0:return[4,import("../../__api/queries/getSuggestedProducts.js")];case 1:return t=e.sent().default,l=null===(o=i.getCurrentRouting())||void 0===o?void 0:o.dynamicCurrencySettings,[4,t(r({locale:i.getCurrentLocale(),dynamicCurrencySettings:l?{roundingFormat:l.roundingFormat,targetCurrencyCode:l.targetCurrencyCode}:void 0},u))];case 2:return s=e.sent(),(c=(null===(d=null==s?void 0:s.data)||void 0===d?void 0:d.map((function(t){return C(t)})))||[]).forEach((function(t){return a(t,i.getCurrentLocale())})),[2,new n(s.data?{data:c,count:s.data.length,facets:null,limit:20,page:1,totalCount:s.data.length}:null,s.graphQLErrors)]}}))}))}function g(r){return t(this,void 0,void 0,(function(){var t,a;return e(this,(function(e){switch(e.label){case 0:return[4,import("../../__api/queries/listProductAttribute.js")];case 1:return[4,(0,e.sent().default)(r)];case 2:return t=e.sent(),null==(a=t.data)||a.forEach((function(t){return d(t,i.getCurrentLocale())})),[2,new n(a,t.graphQLErrors)]}}))}))}function h(r){var i;return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return[4,import("../../__api/queries/getProductCampaigns.js")];case 1:return[4,(0,e.sent().default)(r)];case 2:return t=e.sent(),[2,new n(null===(i=t.data)||void 0===i?void 0:i.map((function(t){return t})),t.graphQLErrors)]}}))}))}function b(r){var i;return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return[4,import("../../__api/queries/getVariantStockLocations.js")];case 1:return[4,(0,e.sent().default)(r)];case 2:return t=e.sent(),[2,new n(null===(i=t.data)||void 0===i?void 0:i.stockLocations.map((function(t){return t})),t.graphQLErrors)]}}))}))}function y(r){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,import("../../__api/mutations/getOrderLineFile.js")];case 1:return[4,(0,t.sent().default)(r)];case 2:return[2,t.sent()]}}))}))}function I(r){return t(this,void 0,void 0,(function(){var t,a;return e(this,(function(e){switch(e.label){case 0:return[4,import("../../__api/queries/listProductOptionSet.js")];case 1:return[4,(0,e.sent().default)(r)];case 2:return t=e.sent(),null==(a=t.data)||a.forEach((function(t){return l(t,i.getCurrentLocale())})),[2,new n(a,t.graphQLErrors)]}}))}))}function A(){return t(this,void 0,void 0,(function(){var t,r;return e(this,(function(e){switch(e.label){case 0:return[4,import("../../__api/queries/searchProducts.js")];case 1:return t=e.sent().ResponseField,r=["DATA"],[2,Object.entries(t).filter((function(t){var e=t[0];return!r.includes(e)})).map((function(t){return t[1]}))]}}))}))}function C(t){var e,n,a,d,l="local"===process.env.NEXT_PUBLIC_ENV;return{id:t.id,type:t.type,groupVariantsByVariantTypeId:t.groupVariantsByVariantTypeId,deleted:t.deleted,attributes:(null===(e=t.attributes)||void 0===e?void 0:e.map((function(t){var e,n,i,a,u,o;return r(r({},t),{value:t.value,productAttributeId:(null===(e=t.productAttribute)||void 0===e?void 0:e.id)||null,productAttributeOptionId:(null===(n=t.productAttributeOption)||void 0===n?void 0:n.id)||null,productAttribute:{id:(null===(i=t.productAttribute)||void 0===i?void 0:i.id)||"",name:(null===(a=t.productAttribute)||void 0===a?void 0:a.name)||"",description:null,type:null===(u=t.productAttribute)||void 0===u?void 0:u.type,tableTemplate:(null===(o=t.productAttribute)||void 0===o?void 0:o.tableTemplate)?t.productAttribute.tableTemplate:null,options:null},productAttributeOption:t.productAttributeOption})})))||[],brand:t.brand?r(r({},t.brand),{id:t.brand.id,name:t.brand.name,createdAt:0,updatedAt:0,description:null,imageId:null,orderType:u.BEST_SELLER,metaData:{id:"",createdAt:0,updatedAt:0,slug:t.brand.slug||""}}):null,campaigns:null===(n=t.campaigns)||void 0===n?void 0:n.map((function(t){return{campaign:t,variantIds:[]}})),categories:(null===(a=t.categories)||void 0===a?void 0:a.map((function(t){return r(r({},t),{categoryPath:t.path.map((function(t){return t.name})),description:null,imageId:null,parentId:null,metaData:t.slug?{id:"",createdAt:0,updatedAt:0,name:t.name||"",slug:t.slug}:null,categoryPathItems:t.path.map((function(t){return{metaData:{id:"",createdAt:0,updatedAt:0,name:t.name||"",slug:t.slug||""},description:null,name:t.name,translations:t.translations,imageId:null,id:t.id,createdAt:0,updatedAt:0}})),createdAt:0,updatedAt:0,orderType:o.BEST_SELLER})})))||[],tags:t.tags||[],description:t.description||"",averageRating:t.averageRating,reviewCount:t.reviewCount,stars:t.stars,baseUnit:t.baseUnit,metaData:r(r({},t.metaData),{id:"",createdAt:0,updatedAt:0,slug:(null===(d=t.metaData)||void 0===d?void 0:d.slug)||""})||null,name:t.name,shortDescription:t.shortDescription||"",productOptionSetId:t.productOptionSetId,variantTypes:t.productVariantTypes.map((function(t){return{order:t.order,variantType:{id:t.variantType.id,name:t.variantType.name,selectionType:t.variantType.selectionType,values:t.variantType.values.map((function(e){return{id:e.id,colorCode:e.colorCode,name:e.name,thumbnailImageId:e.thumbnailImageId,variantTypeId:t.variantType.id}})).filter((function(e){return t.variantValueIds.includes(e.id)}))},variantValueIds:t.variantValueIds}})),variants:t.variants.map((function(e){var n,a,u,o,d;return r(r({},e),{id:e.id,productId:t.id,images:(null===(n=e.images)||void 0===n?void 0:n.map((function(t){return{imageId:t.id,isMain:t.isMain||!1,isVideo:t.isVideo,order:t.order,fileName:t.fileName}})))||null,sellIfOutOfStock:e.sellIfOutOfStock||!1,unit:e.unit,attributes:(null===(a=e.attributes)||void 0===a?void 0:a.map((function(t){var e,n,i,a,u,o;return r(r({},t),{value:t.value,productAttributeId:(null===(e=t.productAttribute)||void 0===e?void 0:e.id)||null,productAttributeOptionId:(null===(n=t.productAttributeOption)||void 0===n?void 0:n.id)||null,productAttribute:{id:(null===(i=t.productAttribute)||void 0===i?void 0:i.id)||"",name:(null===(a=t.productAttribute)||void 0===a?void 0:a.name)||"",description:"",type:null===(u=t.productAttribute)||void 0===u?void 0:u.type,tableTemplate:(null===(o=t.productAttribute)||void 0===o?void 0:o.tableTemplate)?t.productAttribute.tableTemplate:null,options:null},productAttributeOption:t.productAttributeOption})})))||[],sku:e.sku,barcodeList:e.barcodeList||null,price:null===(u=e.prices)||void 0===u?void 0:u.find((function(t){return i.getPriceListId()?t.priceListId===i.getPriceListId():null===t.priceListId})),stock:(null===(o=e.stocks)||void 0===o?void 0:o.filter((function(t){var e;return l||i.getIsEditor()||(null===(e=i.getStockLocationIds())||void 0===e?void 0:e.includes(t.stockLocationId))})).reduce((function(t,e){return e.stockCount+t}),0))||0,variantValues:(null===(d=e.variantValues)||void 0===d?void 0:d.map((function(e){var r=t.productVariantTypes.find((function(t){return t.variantType.id===e.variantTypeId})),n=null==r?void 0:r.variantType.values.find((function(t){return t.id===e.variantValueId}));return{id:e.variantValueId,name:(null==n?void 0:n.name)||"",colorCode:(null==n?void 0:n.colorCode)||"",thumbnailImageId:(null==n?void 0:n.thumbnailImageId)||"",variantTypeId:(null==r?void 0:r.variantType.id)||""}})))||[],isActive:e.isActive||!1})}))}}export{y as getOrderLineFile,h as getProductCampaigns,v as getProductFilterData,m as getRelatedProducts,f as getSuggestedProducts,b as getVariantStockLocations,g as listProductAttribute,s as listProductBackInStockRemind,I as listProductOptionSet,c as saveProductBackInStockRemind,p as searchProducts};

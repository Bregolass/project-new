import{__awaiter as e,__generator as t}from'./../../../../ext/tslib/tslib.es6.js';import*as o from"react";import{observer as n}from"mobx-react-lite";import a from"lodash/sortBy";import c from"../input-with-button/index.js";import l from"../notification-box/index.js";import{CheckoutStep as r}from"../../model.js";import{IkasStorefrontConfig as i}from"@ikas/storefront-config";import{formatCurrency as u}from"../../../../utils/currency.js";import{useTranslation as s}from"../../../../utils/i18n.js";import{CartItem as m}from"./cart-item/index.js";import{FormItem as d}from"../form-item/index.js";import{FormItemType as p}from"../form-item/model.js";import E from"../tooltip/index.js";import C from"../svg/arrow-down.js";import v from"../svg/cross.js";import h from"../svg/gift.js";import f from"./style.module.scss.js";import k from"../svg/ikas.js";var N;!function(e){e.COUPON_CODE_NOT_EXIST="COUPON_CODE_NOT_EXIST",e.COUPON_CODE_NOT_EXIST_FOR_GUESS="COUPON_CODE_NOT_EXIST_FOR_GUESS"}(N||(N={}));var g=n((function(e){var t,n,a=e.vm,c=e.allowExpand,d=a.checkout,p=s().t,E=o.useState(!c),v=E[0],h=E[1],g=o.useState(!1),x=g[0],_=g[1],P=o.useState(null),j=P[0],w=P[1],I=o.useState(0),A=I[0],R=I[1],D=o.useState(null),U=D[0],L=D[1],B=o.useState(!1),F=B[0],X=B[1],G=o.useState(!1),V=G[0],M=G[1];o.useEffect((function(){c&&(v?U&&R(U.getBoundingClientRect().height):R(0))}),[v,U,c,F,V,x]);var z=o.useMemo((function(){switch(j){case N.COUPON_CODE_NOT_EXIST:return p("checkout-page:giftCodeErrorDescription");case N.COUPON_CODE_NOT_EXIST_FOR_GUESS:return p("checkout-page:mustBeSignInToApplyCampaign");default:return""}}),[j]),H=[f.CartSummary,c?f.HideOnDesktop:""].join(" "),$=c?{height:A+"px"}:void 0,Q=[f.ArrowDown,v?f.Rotated:""].join(" ");return d?o.createElement(o.Fragment,null,!!c&&o.createElement(o.Fragment,null,o.createElement("div",{id:"checkout-mobile-summary-header"}),o.createElement("div",{className:f.ExpandHeader,onClick:function(){if(!v){var e=document.getElementById("Checkout"),t=document.getElementById("checkout-mobile-summary-header");e&&t&&e.scrollTo({top:t.offsetTop,behavior:"smooth"})}h(!v)}},o.createElement("div",{className:f.Left},p("checkout-page:summary")),o.createElement("div",{className:f.Price},o.createElement("span",{className:f.PriceText},"".concat(u(a.finalPrice||0,d.currencyCode,d.currencySymbol)," (").concat(d.itemQuantity," ").concat(p("checkout-page:cartItemProduct"),")")),o.createElement("span",{className:Q},o.createElement(C,null))))),o.createElement("div",{className:H},o.createElement("div",{className:f.DetailsContainer,style:$},o.createElement("div",{className:f.Details,ref:L},o.createElement("div",{className:f.ItemsContainer},d.items.map((function(e,t){return o.createElement(m,{key:t,vm:a,cartItem:e,currencyCode:d.currencyCode})}))),o.createElement("div",{className:f.Divider}),o.createElement("div",{className:f.SubTotalInfo},x&&o.createElement("div",{className:f.NotificationContainer},o.createElement(l,{type:"warning",title:p("checkout-page:giftCodeErrorTitle"),content:z,onClose:function(){_(!1),w(null)}})),o.createElement(y,{label:p("checkout-page:subtotal"),value:d.formattedTotalPrice,tooltipText:p("checkout-page:subtotalTooltip")}),!!(null===(t=d.shippingLines)||void 0===t?void 0:t.length)&&o.createElement(y,{label:p("checkout-page:cartShippingTitle"),value:d.shippingTotal?d.formattedShippingTotal:p("checkout-page:free")}),!!a.installmentExtraPrice&&o.createElement(y,{label:p("checkout-page:cartInterest"),value:u(a.installmentExtraPrice,d.currencyCode,d.currencySymbol)}),o.createElement(S,{vm:a}),o.createElement(T,{vm:a}),(a.step===r.SUCCESS&&(!!a.checkout.note||!!a.checkout.appliedCouponCode)||a.step!==r.SUCCESS)&&o.createElement("div",{className:f.Divider,style:{marginTop:"24px",marginBottom:"24px"}}),o.createElement(b,{vm:a,isAddingCoupon:V,setAddingCoupon:M,setCouponError:_,setCouponErrorCode:w}),o.createElement(O,{vm:a,isAddingNote:F,setAddingNote:X})),o.createElement("div",{className:f.TotalContainer},o.createElement("div",{className:f.TitleContainer},o.createElement("div",{className:f.Title},p("checkout-page:total"))),o.createElement("div",null,o.createElement("div",{className:f.TotalPricesContainer},o.createElement("div",{className:f.TotalPrice},u(a.finalPrice||0,d.currencyCode,d.currencySymbol)),!!d.$totalTax&&!!(null===(n=a.customizationProps)||void 0===n?void 0:n.showTax)&&o.createElement("div",{className:[f.TotalTax].join(" ")},p("checkout-page:cartTaxTitle")+" "+d.$formattedTotalTax)))),o.createElement("div",{className:f.PoweredBy},o.createElement("span",null,"powered by"),o.createElement("a",{href:"https://ikas.com"+("tr"===i.getCurrentLocale()?"/tr":""),target:"_blank"},o.createElement(k,null))))))):null})),y=n((function(e){var t=e.label,n=e.value,a=e.tooltipText;return o.createElement("div",{className:f.InfoRow},o.createElement("div",{className:f.Label},o.createElement("span",null,t),!!a&&o.createElement(E,{text:a,style:{marginLeft:"8px"}})),o.createElement("div",{className:f.Value},n))})),S=n((function(e){var t=e.vm,n=s().t;return t.checkout?o.createElement(o.Fragment,null,a(t.checkout.nonCouponAdjustments||[],"order").map((function(e,a){return o.createElement("div",{className:f.InfoRow,key:a},o.createElement("div",{className:f.Label},"INTEREST"===e.name?n("checkout-page:cartInterest"):e.name),o.createElement("div",{className:f.Value},o.createElement("span",null,"DECREMENT"===e.type?"- ":"")," ",o.createElement("span",null,u(e.amount,t.checkout.currencyCode,t.checkout.currencySymbol))))}))):null})),T=n((function(e){var t,n,a=e.vm,c=s().t;return a.checkout?o.createElement(o.Fragment,null,a.step!==r.SUCCESS&&((null===(t=a.checkout.selectedPaymentGateway)||void 0===t?void 0:t.getCalculatedAdditionalPrices(a.checkout.totalFinalPrice||0,a.checkout.shippingLines||null))||[]).filter((function(e){return 0!==e.amount})).map((function(e,t){return o.createElement("div",{className:f.InfoRow,key:t},o.createElement("div",{className:f.Label},e.name),o.createElement("div",{className:f.Value},o.createElement("span",null,"DECREMENT"===e.type?"- ":"")," ",o.createElement("span",null,u(e.amount,a.checkout.currencyCode,a.checkout.currencySymbol))))})),null===(n=a.checkout.giftPackageLines)||void 0===n?void 0:n.map((function(e,t){return o.createElement("div",{className:f.InfoRow,key:t},o.createElement("div",{className:f.Label},o.createElement("div",{className:f.GiftLabel},o.createElement(h,{style:{position:"relative",top:"-1px"}}),o.createElement("span",null,c("checkout-page:giftPackage")))),o.createElement("div",{className:f.Value},o.createElement("span",null,u(e.price,a.checkout.currencyCode,a.checkout.currencySymbol))))}))):null})),b=n((function(n){var a=n.vm,l=n.isAddingCoupon,i=n.setAddingCoupon,m=n.setCouponError,d=n.setCouponErrorCode,p=s().t,E=o.useState(""),C=E[0],h=E[1],k=o.useState(!1),N=k[0],g=k[1],y=o.useRef(null);o.useEffect((function(){l&&y.current&&y.current.focus()}),[l]);if(a.step===r.SUCCESS&&!a.checkout.appliedCouponCode)return null;var S=a.checkout.couponAdjustment;return o.createElement("div",{className:f.InfoRow},!a.checkout.appliedCouponCode&&!l&&o.createElement("div",{className:f.ActionTextBtn,onClick:function(){return i(!0)}},p("checkout-page:addCouponCode")),l&&o.createElement(c,{value:C,placeholder:p("checkout-page:couponCode"),buttonLabel:p("checkout-page:actions.apply"),inputRef:y,onClick:function(){return e(void 0,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return a.checkout.couponCode=C,g(!0),[4,a.onCouponCodeApply()];case 1:return e.sent(),g(!1),h(""),a.checkout.appliedCouponCode&&!a.couponError?(i(!1),m(!1),d(null)):(a.checkout.couponCode=null,m(!0),d(a.couponError)),[2]}}))}))},isLoading:N,onChange:h}),!!a.checkout.appliedCouponCode&&!l&&o.createElement("div",{className:[f.ActionTextBtn,f.NoUnderline,f.Light].join(" ")},p("checkout-page:couponCode"),o.createElement("span",{className:f.AppliedCoupon},o.createElement("span",{className:f.CouponCode},a.checkout.appliedCouponCode),a.step!==r.SUCCESS&&o.createElement("span",{className:f.ClearCoupon,onClick:function(){return e(void 0,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return a.checkout.couponCode=null,g(!0),[4,a.onCouponCodeApply()];case 1:return e.sent(),g(!1),[2]}}))}))}},o.createElement(v,null)))),!!a.checkout.appliedCouponCode&&!l&&o.createElement("div",{className:f.Value},o.createElement("span",null,"DECREMENT"===(null==S?void 0:S.type)?"- ":"")," ",o.createElement("span",null,u((null==S?void 0:S.amount)||0,a.checkout.currencyCode,a.checkout.currencySymbol))))})),O=n((function(e){var t=e.vm,n=e.isAddingNote,a=e.setAddingNote,c=s().t,l=o.useState(t.checkout.note?c("checkout-page:editOrderNote"):c("checkout-page:addOrderNote"))[0],i=o.useCallback((function(){a(!0)}),[]),u=o.useCallback((function(e){t.checkout.note=e}),[t,t.checkout]);if(!t.checkoutSettings.showCheckoutNote)return null;var m=t.step===r.SUCCESS;return m&&!t.checkout.note?null:o.createElement("div",{className:f.InfoRow},!n&&!m&&o.createElement("div",{className:f.ActionTextBtn,onClick:i},l),(n||m)&&o.createElement("div",{className:[f.CheckoutNoteContainer,m?f.Success:""].join(" ")},o.createElement("div",{className:f.Title},c("checkout-page:orderNote")),m?o.createElement("div",{className:f.CheckoutNoteDisplay},t.checkout.note):o.createElement(d,{style:{width:"100%"},type:p.TEXT_AREA,disableResize:!0,label:"",value:t.checkout.note||"",onChange:u})))}));export{g as CartSummary,N as CouponErrorCode};

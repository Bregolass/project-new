import e,{useRef as t,useState as o,useEffect as a}from"react";import{observer as n}from"mobx-react-lite";import r from"../modal/index.js";import s from"./svg/master-pass.js";import c from"./style.module.scss.js";import{useTranslation as m}from"../../../../../utils/i18n.js";import{Button as l}from"../../button/index.js";import{FormItem as i}from"../../form-item/index.js";import{FormItemType as p}from"../../form-item/model.js";var u=n((function(n){var u=n.visible,d=n.type,f=n.vm,v=n.onClose,b=m().t,h=t(),k=o(180),x=k[0],g=k[1],M=o(""),E=M[0],P=M[1],T=o(!1),y=T[0],C=T[1],j=o(!1),O=j[0],N=j[1],V=function(){if(!O&&E&&f.checkout.masterPassPaymentGateway){N(!0),f.mpVM.onOtpFormSubmit({validationCode:E,store:f.store,checkout:f.checkout,callback:function(){N(!1),P(""),R()}})}},R=function(){g(0)},w=function(){g(180)},I=function(){g(180)};a((function(){if(!(x<1&&h.current))return h.current&&clearInterval(h.current),h.current=setInterval((function(){g(x-1)}),1e3),function(){h.current&&clearInterval(h.current)};clearInterval(h.current)}),[x]);var L,S,B,D,F,q,A=x<=120,G=e.createElement("div",null,e.createElement("div",{className:c.Wrapper},"masterPassOtp"===d&&e.createElement("span",{"data-mr":!0,className:c.Logo},e.createElement(s,null)),e.createElement("p",{className:c.Text},b("masterPassOtp"===d?"checkout-page:masterPass.otpModal.otpTextMasterPass":"checkout-page:masterPass.otpModal.otpTextBank"))),e.createElement("div",{className:c.Countdown},b("checkout-page:masterPass.otpModal.countdownText"),e.createElement("strong",null,(L=x%3600,S=Math.floor(L/60),B=L%60,D=Math.ceil(B),F=S<10?"0".concat(S):S,q=D<10?"0".concat(D):D,"".concat(F,":").concat(q)))),f.mpVM.otpResponse.text&&e.createElement("div",{role:"error"===f.mpVM.otpResponse.status?"alert":"",className:c.OtpResponseText},f.mpVM.otpResponse.text),e.createElement("form",{onSubmit:function(e){e.preventDefault(),V()}},e.createElement(i,{required:!0,type:p.TEXT,label:b("checkout-page:masterPass.otpModal.inputLabel"),name:"one-time-code",autocomplete:"one-time-code",rightContent:f.mpVM.isOtpFormSubmitAtLeastOnce&&A?e.createElement("button",{type:"button",className:c.ResendButton,disabled:y,onClick:function(e){e.stopPropagation(),y||(C(!0),f.mpVM.resendOtp({store:f.store,checkout:f.checkout,callback:function(){C(!1),I(),P("")}}))}},b("checkout-page:masterPass.otpModal.resendText")):void 0,value:E,onChange:function(e){P(e)}}),e.createElement(l,{type:"submit",style:{width:"100%",marginTop:"16px"},text:b("checkout-page:masterPass.otpModal.buttonText"),isLoading:O,isDisabled:!E,onClick:V})));return a((function(){u?w():R()}),[u]),a((function(){w()}),[d]),console.log("calisti modal",u),e.createElement(r,{visible:u,onClose:v},G)}));export{u as default};

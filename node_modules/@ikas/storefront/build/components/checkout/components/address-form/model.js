import{__awaiter as t,__generator as e,__assign as i}from'./../../../../ext/tslib/tslib.es6.js';import{makeAutoObservable as s}from"mobx";import r from"lodash/sortBy";import"../../../../models/data/blog/category/index.js";import"../../../../models/data/blog/content/index.js";import"../../../../models/data/blog/meta-data/index.js";import"../../../../models/data/blog/tag/index.js";import"../../../../models/data/blog/index.js";import"../../../../models/data/brand/index.js";import"@ikas/storefront-models";import"../../../../models/data/campaign-offer/index.js";import"../../../../models/data/cart/campaign-offer/index.js";import"../../../../models/data/cart/index.js";import"../../../../models/data/category/path-item/index.js";import"../../../../models/data/category/index.js";import"../../../../models/data/checkout/index.js";import"../../../../models/data/checkout-settings/index.js";import"../../../../models/data/city/index.js";import"../../../../models/data/country/index.js";import"../../../../models/data/customer/address/index.js";import"../../../../models/data/customer/address/ikas-localized-customer-address.js";import"../../../../models/data/customer/attribute/index.js";import"../../../../models/data/customer/review/summary/index.js";import"../../../../models/data/customer/review/index.js";import"../../../../models/data/customer/index.js";import"../../../../models/data/district/index.js";import"../../../../models/data/favorite-product/index.js";import"../../../../models/data/filter-category/index.js";import"../../../../models/data/html-meta-data/index.js";import"../../../../models/data/image/index.js";import{IkasOrderAddressCity as o}from"../../../../models/data/order/address/city/index.js";import{IkasOrderAddressCountry as n}from"../../../../models/data/order/address/country/index.js";import{IkasOrderAddressDistrict as d}from"../../../../models/data/order/address/district/index.js";import"../../../../models/data/order/address/index.js";import"../../../../models/data/order/line-item/option/value/index.js";import"../../../../models/data/order/line-item/variant/value/index.js";import"../../../../models/data/order/line-item/variant/index.js";import"../../../../models/data/order/line-item/index.js";import"../../../../models/data/order/package/index.js";import"../../../../models/data/order/transaction/index.js";import"../../../../models/data/order/index.js";import"../../../../models/data/payment-gateway/index.js";import"../../../../models/data/product/attribute-value/index.js";import"../../../../models/data/product/filter/index.js";import"../../../../models/data/product/option-set/option/index.js";import"../../../../models/data/product/option-set/index.js";import"../../../../models/data/product/stock-location/index.js";import"../../../../models/data/product/variant/price/index.js";import"../../../../models/data/product/variant/index.js";import"../../../../models/data/variant-type/index.js";import"../../../../models/data/product/index.js";import"../../../../models/data/raffle/index.js";import"../../../../models/data/state/index.js";import"../../../../models/data/theme-json/index.js";import"../../../../models/data/theme-json/component/index.js";import"../../../../models/data/theme-json/custom-data/index.js";import"../../../../models/data/variant-type/variant-value/index.js";import"@ikas/localized-address";import"../../../../models/ui/blog-list/index.js";import"../../../../models/ui/blog-category-list/index.js";import"../../../../models/ui/brand-list/index.js";import"../../../../models/ui/category-list/index.js";import"../../../../models/ui/product-list/index.js";import"../../../../models/ui/product-attribute-detail/index.js";import"../../../../models/ui/product-attribute-list/index.js";import"../../../../models/ui/customer-review-list/index.js";import"../../../../models/ui/customer-review-summary-list/index.js";import"../../../../models/ui/validator/index.js";import"../../../../models/ui/validator/rules/index.js";import"../../../../models/ui/validator/form/login.js";import"../../../../models/ui/validator/form/address.js";import"../../../../models/ui/validator/form/ikas-address.js";import"../../../../models/ui/validator/form/register.js";import"../../../../models/ui/validator/form/contact-form.js";import"../../../../models/ui/validator/form/forgot-password.js";import"../../../../models/ui/validator/form/recover-password.js";import"../../../../models/ui/validator/form/account-info.js";import"../../../../models/ui/validator/form/raffle-form.js";import"../../../../models/ui/validator/form/customer-review.js";import"../../../../models/ui/raffle-list/index.js";import{stringSorter as a,capitalize as l}from"../../../../utils/helper.js";import{FREE_TEXT_CITY_COUNTRY_LIST as u,DISTRICT_HIDDEN_COUNTRY_LIST as m}from"../../../../utils/constants.js";import c from"../../../../store/location/index.js";import{IkasStorefrontConfig as p}from"@ikas/storefront-config";var h=function(){function h(i){var r=this;this.isCorporate=!1,this.isErrorsVisible=!1,this.allowedCountryIds=null,this.allowCorporateInfo=!1,this.allowTitleChange=!1,this.firstNameChangeCallback=null,this.lastNameChangeCallback=null,this.countries=[],this.states=[],this.cities=[],this.districts=[],this.myCountryCode=null,this.fillDropdownOptions=function(){return t(r,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,this.listCountries()];case 1:return t.sent(),[4,this.listStates()];case 2:return t.sent(),[4,this.listCities()];case 3:return t.sent(),[4,this.listDistricts()];case 4:return t.sent(),[2]}}))}))},this.listCountries=function(){return t(r,void 0,void 0,(function(){var t,i,s,r,o,n,d,a,l=this;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),this.myCountryCode?[3,2]:[4,c.getMyCountry()];case 1:t=e.sent(),this.myCountryCode=t.data,e.label=2;case 2:return[4,c.listCountry({id:(null===(d=this.allowedCountryIds)||void 0===d?void 0:d.length)?{in:this.allowedCountryIds}:void 0,locale:p.getCurrentLocale()})];case 3:return i=e.sent(),s=i.data||[],r=p.getCurrentRouting(),(null===(a=null==r?void 0:r.countryCodes)||void 0===a?void 0:a.length)?s=s.filter((function(t){var e;return t.iso2&&(null===(e=r.countryCodes)||void 0===e?void 0:e.includes(t.iso2))})):(o=p.getRoutings().filter((function(t){return t.id!==p.getStorefrontRoutingId()})),s=s.filter((function(t){return t.iso2&&!o.some((function(e){var i;return null===(i=e.countryCodes)||void 0===i?void 0:i.includes(t.iso2)}))}))),this.countries=s,1!==this.countries.length||this.country?this.countries.length&&this.myCountryCode&&!this.country&&((n=this.countries.find((function(t){return t.iso2===l.myCountryCode})))?this.onCountryChange(n.id):this.onCountryChange(this.countries[0].id)):this.onCountryChange(this.countries[0].id),[3,5];case 4:return e.sent(),[3,5];case 5:return[2]}}))}))},this.listStates=function(){return t(r,void 0,void 0,(function(){var t,i;return e(this,(function(e){switch(e.label){case 0:if(!(null===(i=this.country)||void 0===i?void 0:i.id))return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,c.listState({countryId:{eq:this.country.id},locale:p.getCurrentLocale()})];case 2:return t=e.sent(),this.states=t.data||[],this.hasState||this.onStateChange(this.states[0].id),[3,4];case 3:return e.sent(),[3,4];case 4:return[2]}}))}))},this.listCities=function(){return t(r,void 0,void 0,(function(){var t,i,s;return e(this,(function(e){switch(e.label){case 0:if(!(null===(i=this.state)||void 0===i?void 0:i.id)||!(null===(s=this.country)||void 0===s?void 0:s.id))return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,c.listCity({stateId:{eq:this.state.id},countryId:{eq:this.country.id}})];case 2:return t=e.sent(),this.cities=t.data||[],[3,4];case 3:return e.sent(),[3,4];case 4:return[2]}}))}))},this.listDistricts=function(){return t(r,void 0,void 0,(function(){var t,i,s,r;return e(this,(function(e){switch(e.label){case 0:if(!(null===(i=this.city)||void 0===i?void 0:i.id)||this.isDistrictHidden)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,c.listDistrict({cityId:{eq:this.city.id},stateId:(null===(s=this.state)||void 0===s?void 0:s.id)?{eq:null===(r=this.state)||void 0===r?void 0:r.id}:void 0})];case 2:return t=e.sent(),this.districts=t.data||[],this.districts.length?this.address.isDistrictRequired=!0:this.address.isDistrictRequired=!1,[3,4];case 3:return e.sent(),[3,4];case 4:return[2]}}))}))},this.modelToOption=function(t){return{label:t.name,value:t.id+""}},this.onFirstNameChange=function(t){r.firstNameChangeCallback&&r.firstNameChangeCallback(t),r.address.firstName=t},this.onLastNameChange=function(t){r.lastNameChangeCallback&&r.lastNameChangeCallback(t),r.address.lastName=t},this.onPhoneChange=function(t){r.address.phone=t},this.onIdentityNumberChange=function(t){t?t.length<=11&&(r.address.identityNumber=t):r.address.identityNumber=""},this.onAddressTitleChange=function(t){r.address.title=t},this.onAddressLine1Change=function(t){r.address.addressLine1=t},this.onAddressLine2Change=function(t){r.address.addressLine2=t},this.onAddressPostalCodeChange=function(t){r.address.postalCode=t},this.onCountryChange=function(t){var e;if((null===(e=r.country)||void 0===e?void 0:e.id)!==t){var i=r.countries.find((function(e){return e.id===t}));r.address.country=new n({id:(null==i?void 0:i.id)||null,name:(null==i?void 0:i.name)||"",code:(null==i?void 0:i.iso3)||null,iso2:(null==i?void 0:i.iso2)||null,iso3:(null==i?void 0:i.iso3)||null}),r.address.state=null,r.address.city=null,r.address.district=null,r.address.phone=null,r.states=[],r.cities=[],r.districts=[],r.listStates()}},this.onStateChange=function(t){var e;if((null===(e=r.state)||void 0===e?void 0:e.id)!==t){var i=r.states.find((function(e){return e.id===t}));r.address.state={id:i.id,name:null==i?void 0:i.name,code:null==i?void 0:i.stateCode},r.address.isFreeTextCity||(r.address.city=null,r.cities=[],r.listCities()),r.address.isFreeTextDistrict||(r.address.district=null,r.districts=[])}},this.onCityChange=function(t){var e;if((null===(e=r.city)||void 0===e?void 0:e.id)!==t){var i=r.cities.find((function(e){return e.id===t}));r.address.city=new o({id:i.id,name:i.name}),r.address.isFreeTextDistrict||(r.address.district=null,r.districts=[],r.listDistricts())}},this.onCityInputChange=function(t){r.districts=[],r.address.city=new o({id:void 0,name:t})},this.onDistrictChange=function(t){var e;if((null===(e=r.district)||void 0===e?void 0:e.id)!==t){var i=r.districts.find((function(e){return e.id===t}));r.address.district=new d({id:i.id,name:i.name})}},this.onDistrictInputChange=function(t){r.address.district=new d({id:void 0,name:t})},this.onCorporateChange=function(t){r.isCorporate=t,t||(r.address.company=null,r.address.taxNumber=null,r.address.taxOffice=null)},this.onCompanyChange=function(t){r.address.company=t},this.onTaxNumberChange=function(t){r.address.taxNumber=t},this.onTaxOfficeChange=function(t){r.address.taxOffice=t},this.address=i.address,this.isCorporate=i.isCorporate||!1,this.isErrorsVisible=i.isErrorsVisible||!1,this.isCustomerAddress=i.isCustomerAddress||!1,this.allowedCountryIds=i.allowedCountryIds,this.allowCorporateInfo=i.allowCorporateInfo||!1,this.allowTitleChange=i.allowTitleChange||!1,this.firstNameChangeCallback=i.firstNameChangeCallback||null,this.lastNameChangeCallback=i.lastNameChangeCallback||null,s(this,{firstNameChangeCallback:!1,lastNameChangeCallback:!1}),this.fillDropdownOptions()}return Object.defineProperty(h.prototype,"firstName",{get:function(){return this.address.firstName},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"lastName",{get:function(){return this.address.lastName},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"phone",{get:function(){return this.address.phone},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"identityNumber",{get:function(){return this.address.identityNumber},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"country",{get:function(){return this.address.country},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"state",{get:function(){return this.address.state},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"city",{get:function(){return this.address.city},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"district",{get:function(){return this.address.district},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"countryOptions",{get:function(){var t=this.countries.map(this.modelToOption);return t.sort((function(t,e){return a(t.label,e.label)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"stateOptions",{get:function(){var t=this.states.map(this.modelToOption);return t.sort((function(t,e){return a(t.label,e.label)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"cityOptions",{get:function(){return r(this.cities,"order").map(this.modelToOption)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"districtOptions",{get:function(){var t=this.districts.map((function(t){return i(i({},t),{name:l(t.name)})})).map(this.modelToOption);return t.sort((function(t,e){return a(t.label,e.label)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"hasState",{get:function(){return this.states.length>1},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isFreeTextCity",{get:function(){var t=this;return u.some((function(e){var i,s;return(null===(s=null===(i=t.address.country)||void 0===i?void 0:i.iso2)||void 0===s?void 0:s.toLowerCase())===e.toLowerCase()}))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isDistrictHidden",{get:function(){var t=this;return m.some((function(e){var i,s;return(null===(s=null===(i=t.address.country)||void 0===i?void 0:i.iso2)||void 0===s?void 0:s.toLowerCase())===e.toLowerCase()}))},enumerable:!1,configurable:!0}),h}();export{h as default};

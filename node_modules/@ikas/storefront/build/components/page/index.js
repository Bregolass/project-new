import{__assign as e,__awaiter as t,__generator as o}from'./../../ext/tslib/tslib.es6.js';import*as i from"react";import{observer as r}from"mobx-react-lite";import{useRouter as a}from"next/router.js";import"../../models/data/blog/category/index.js";import"../../models/data/blog/content/index.js";import"../../models/data/blog/meta-data/index.js";import"../../models/data/blog/tag/index.js";import"../../models/data/blog/index.js";import"../../models/data/brand/index.js";import{IkasThemeJsonPageType as s}from"@ikas/storefront-models";import"mobx";import"../../models/data/campaign-offer/index.js";import"../../models/data/cart/campaign-offer/index.js";import"../../models/data/cart/index.js";import"../../models/data/category/path-item/index.js";import"../../models/data/category/index.js";import"../../models/data/checkout/index.js";import"../../models/data/checkout-settings/index.js";import"../../models/data/city/index.js";import"../../models/data/country/index.js";import"../../models/data/customer/address/index.js";import"../../models/data/customer/address/ikas-localized-customer-address.js";import"../../models/data/customer/attribute/index.js";import"../../models/data/customer/review/summary/index.js";import"../../models/data/customer/review/index.js";import"../../models/data/customer/index.js";import"../../models/data/district/index.js";import"../../models/data/favorite-product/index.js";import"../../models/data/filter-category/index.js";import"../../models/data/html-meta-data/index.js";import"../../models/data/image/index.js";import{IkasMerchantSettings as d}from"../../models/data/merchant-settings/index.js";import"../../models/data/order/address/index.js";import"../../models/data/order/line-item/option/value/index.js";import"../../models/data/order/line-item/variant/value/index.js";import"../../models/data/order/line-item/variant/index.js";import"../../models/data/order/line-item/index.js";import"../../models/data/order/package/index.js";import"../../models/data/order/transaction/index.js";import"../../models/data/order/index.js";import"../../models/data/payment-gateway/index.js";import"../../models/data/product/attribute-value/index.js";import"../../models/data/product/filter/index.js";import"../../models/data/product/option-set/option/index.js";import"../../models/data/product/option-set/index.js";import"../../models/data/product/stock-location/index.js";import"../../models/data/product/variant/price/index.js";import"../../models/data/product/variant/index.js";import"../../models/data/variant-type/index.js";import"../../models/data/product/index.js";import"../../models/data/raffle/index.js";import"../../models/data/state/index.js";import"../../models/data/theme-json/index.js";import"../../models/data/theme-json/component/index.js";import{IkasThemeJsonCustomData as n}from"../../models/data/theme-json/custom-data/index.js";import"../../models/data/variant-type/variant-value/index.js";import"@ikas/localized-address";import"../../models/ui/blog-list/index.js";import"../../models/ui/blog-category-list/index.js";import"../../models/ui/brand-list/index.js";import"../../models/ui/category-list/index.js";import"../../models/ui/product-list/index.js";import"../../models/ui/product-attribute-detail/index.js";import"../../models/ui/product-attribute-list/index.js";import"../../models/ui/customer-review-list/index.js";import"../../models/ui/customer-review-summary-list/index.js";import"../../models/ui/validator/index.js";import"../../models/ui/validator/rules/index.js";import"../../models/ui/validator/form/login.js";import"../../models/ui/validator/form/address.js";import"../../models/ui/validator/form/ikas-address.js";import"../../models/ui/validator/form/register.js";import"../../models/ui/validator/form/contact-form.js";import"../../models/ui/validator/form/forgot-password.js";import"../../models/ui/validator/form/recover-password.js";import"../../models/ui/validator/form/account-info.js";import"../../models/ui/validator/form/raffle-form.js";import"../../models/ui/validator/form/customer-review.js";import"../../models/ui/raffle-list/index.js";import{IkasStorefrontConfig as m}from"@ikas/storefront-config";import{Analytics as l}from"../../analytics/analytics.js";import"../../analytics/head/index.js";import{IkasPageHead as p}from"./head.js";import{ThemeComponent as c}from"./ThemeComponent.js";import{IkasBaseStore as u}from"../../store/base.js";import"../../store/customer/index.js";import"../../store/cart/index.js";import{initIkasEvents as f}from"../../analytics/events.js";import{IkasPageDataInit as j}from"../../page-data-init/index.js";import{setAPIClientConfig as x}from"@ikas/storefront-api";var g=r((function(r){var c=r.propValues,g=r.themeJsonComponents,y=r.customDataList,h=r.pageType,b=r.pageTitle,w=r.pageDescription,S=r.pageSpecificData,C=r.canonicals,k=r.disableIndex,D=r.settings,P=r.configJson,I=r.reInitOnBrowser,E=r.addOgpMetas,T=r.components,M=r.productReviewSummary,O=a(),R=i.useState(),V=R[0],z=R[1];m.init(e(e({},P),{currentPageComponents:T,loginRequiredCallback:function(){O.push("/account/login")}})),u.getInstance().router=O,x();var B=u.getInstance();B.router=O,B.currentPageType=h;var F=i.useState(!1),H=F[0],U=F[1],A=i.useMemo((function(){return(null==V?void 0:V.id)===(null==S?void 0:S.id)&&j.pageSpecificData&&j.isBrowser?h===s.PRODUCT&&j._initProductOnBrowser(j.pageSpecificData):j.setPageSpecificData(S,h,H),j.initPagePropValues(c,g,y.map((function(e){return new n(e)})),D,H)}),[H,c,h,D,S,g]);i.useEffect((function(){I&&U("undefined"!=typeof window),B.cartStore.getCart(),B.checkLocalization(),f()}),[]),i.useEffect((function(){S?(null==V?void 0:V.id)!==S.id&&z(S):z(null)}),[S]),i.useEffect((function(){var e=function(){B.customerStore.routeChangeInit()};return O.events.on("routeChangeStart",e),function(){O.events.off("routeChangeStart",e)}}),[]),i.useEffect((function(){!function(e,i){var r,a;t(this,void 0,void 0,(function(){var t,d,n,m,p;return o(this,(function(o){switch(o.label){case 0:t=u.getInstance(),l.pageView(e),o.label=1;case 1:return o.trys.push([1,4,,5]),e===s.PRODUCT&&(d=i,l.productView(d),t.customerStore.onProductView(d.id,d.selectedVariant.id)),e===s.CATEGORY&&(m=null===(r=(n=i).categoryPathItems)||void 0===r?void 0:r.map((function(e){return e.name})).join(" > "),m=n.categoryPathItems&&(null===(a=n.categoryPathItems)||void 0===a?void 0:a.length)>0?m+" > "+n.name:n.name,l.viewCategory(m,n)),e!==s.CART?[3,3]:[4,t.cartStore.waitUntilInitialized()];case 2:o.sent(),l.viewCart(t.cartStore.cart),o.label=3;case 3:return[3,5];case 4:return p=o.sent(),console.error(p),[3,5];case 5:return[2]}}))}))}(h,j.pageSpecificData)}),[h,S]);var J=i.useMemo((function(){var e=A.find((function(e){return e.component.isHeader})),t=A.find((function(e){return e.component.isFooter})),o=A.filter((function(e){return!e.component.isHeader&&!e.component.isFooter}))||[];return i.createElement("div",{style:{position:"relative",minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"space-between"}},i.createElement("div",null,e&&v(e,D,-1),o.map((function(e,t){return v(e,D,t)}))),t&&v(t,D,-1))}),[A,D]),L=i.useMemo((function(){return m.getMerchantSettings()?new d(m.getMerchantSettings()):null}),[m.getMerchantSettings()]);return i.createElement(i.Fragment,null,i.createElement(p,{pageType:h,pageTitle:b,pageDescription:w,pageSpecificData:j.pageSpecificData,canonicals:C,disableIndex:k,merchantSettings:L,addOgpMetas:E,productReviewSummary:M}),J)})),v=function(e,t,o){return i.createElement(c,{key:e.pageComponent.id,index:o,pageComponentPropValue:e,settings:t})};export{g as IkasPage,v as renderComponent};

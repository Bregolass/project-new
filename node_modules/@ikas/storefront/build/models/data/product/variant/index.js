import{__awaiter as t,__generator as e}from'./../../../../ext/tslib/tslib.es6.js';import{IkasProductPrice as i}from"./price/index.js";import{IkasVariantValue as r}from"../../variant-type/variant-value/index.js";import{IkasProductAttributeValue as n}from"../attribute-value/index.js";import{IkasProductImage as o}from"../image/index.js";import{IkasProductVariantFunctions as a}from"@ikas/storefront-model-functions";import{IkasStorefrontConfig as s}from"@ikas/storefront-config";import{saveProductBackInStockRemind as u,listProductBackInStockRemind as c}from"@ikas/storefront-api";import d from"lodash/groupBy";import p from"lodash/sortBy";import{IkasProductVariantUnit as m}from"./unit/index.js";var f=function(){function f(t){void 0===t&&(t={}),this._backInStockReminderSaved=!1,this.id=t.id||Date.now()+"",this.productId=t.productId||"",this.sku=t.sku||null,this.barcodeList=t.barcodeList||[],this.variantValues=t.variantValues?t.variantValues.map((function(t){return new r(t)})):[],this.images=t.images?t.images.map((function(t){return new o(t)})):[],this.attributes=t.attributes?t.attributes.map((function(t){return new n(t)})):[],this.price=t.price?new i(t.price):new i,this.stock=t.stock||0,this.isActive=void 0===t.isActive||t.isActive,this.campaigns=t.campaigns||[],this.unit=t.unit?new m(t.unit):null,this.sellIfOutOfStock=t.sellIfOutOfStock||!1,this.images=p(this.images,"order")}return Object.defineProperty(f.prototype,"mainImage",{get:function(){var t=a.getMainImage(this);return t?new o(t):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"hasStock",{get:function(){return a.hasStock(this)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isBackInStockEnabled",{get:function(){return s.isBackInStockEnabled()},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isBackInStockCustomerLoginRequired",{get:function(){return s.isCustomerLoginRequiredForBackInStock()},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isBackInStockReminderSaved",{get:function(){return this._backInStockReminderSaved},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"groupedAttributeValues",{get:function(){var t,e=d(this.attributes,"productAttributeId");return(null===(t=this.attributes)||void 0===t?void 0:t.map((function(t){var i=t.productAttributeId;if(i){var r=e[i];return(null==r?void 0:r.length)&&r[0].productAttribute?{attribute:r[0].productAttribute,values:r}:void 0}})).filter((function(t){return!!t})))||[]},enumerable:!1,configurable:!0}),f.prototype.saveBackInStockReminder=function(i){var r;return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return[4,c({email:{eq:i},productId:{eq:this.productId},variantId:{eq:this.id}})];case 1:return(t=e.sent())&&(null===(r=t.data)||void 0===r?void 0:r.length)?(this._backInStockReminderSaved=!0,[2,!1]):[3,2];case 2:return[4,u({input:{email:i,productId:this.productId,variantId:this.id}})];case 3:return e.sent().isSuccess?(this._backInStockReminderSaved=!0,[2,!0]):(this._backInStockReminderSaved=!1,[2,!1]);case 4:return[2]}}))}))},f}();export{f as IkasProductVariant};

import{__awaiter as e,__generator as r,__assign as t}from'./../../../../ext/tslib/tslib.es6.js';import{makeObservable as s,computed as o,observable as a,action as i}from"mobx";import{Validator as n}from"../index.js";import{IkasBaseStore as l}from"../../../../store/base.js";import"../../../../store/customer/index.js";import"../../../../store/cart/index.js";import{RequiredRule as m,EmailRule as u,PhoneRule as f}from"../rules/index.js";var c=function(){function c(e){var r=this;this.model={firstName:"",lastName:"",email:"",phone:null,message:""},this.onFirstNameChange=function(e){r.firstName=e},this.onLastNameChange=function(e){r.lastName=e},this.onEmailChange=function(e){r.email=e},this.onPhoneChange=function(e){r.phone=e},this.onMessageChange=function(e){r.message=e},s(this,{emailErrorMessage:o,messageErrorMessage:o,firstNameErrorMessage:o,lastNameErrorMessage:o,phoneErrorMessage:o,hasError:o,redirect:o,model:a,validateAll:i,saveContactForm:i});var t=[new m({fieldKey:"firstName",valuePath:"firstName",message:e.message.requiredRule}),new m({fieldKey:"lastName",valuePath:"lastName",message:e.message.requiredRule}),new m({fieldKey:"email",valuePath:"email",message:e.message.requiredRule}),new m({fieldKey:"message",valuePath:"message",message:e.message.requiredRule}),new u({fieldKey:"email",valuePath:"email",message:e.message.emailRule})];e.message.phoneRule&&t.push(new f({fieldKey:"phone",valuePath:"phone",message:e.message.phoneRule})),this.validator=new n(this.model,t)}return Object.defineProperty(c.prototype,"firstName",{get:function(){return this.model.firstName},set:function(e){this.model.firstName=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastName",{get:function(){return this.model.lastName},set:function(e){this.model.lastName=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"email",{get:function(){return this.model.email},set:function(e){this.model.email=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"phone",{get:function(){return this.model.phone},set:function(e){this.model.phone=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"message",{get:function(){return this.model.message},set:function(e){this.model.message=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"hasError",{get:function(){return this.validator.hasError},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"firstNameErrorMessage",{get:function(){return this.validator.results.firstName.errorMessage},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastNameErrorMessage",{get:function(){return this.validator.results.lastName.errorMessage},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"emailErrorMessage",{get:function(){return this.validator.results.email.errorMessage},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"phoneErrorMessage",{get:function(){var e,r,t;if(null===(r=null===(e=this.validator.results)||void 0===e?void 0:e.phone)||void 0===r?void 0:r.errorMessage)return null===(t=this.validator.results)||void 0===t?void 0:t.phone.errorMessage},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"messageErrorMessage",{get:function(){return this.validator.results.message.errorMessage},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"redirect",{get:function(){if("undefined"!=typeof window)return new URLSearchParams(window.location.search).get("redirect")},enumerable:!1,configurable:!0}),c.prototype.validateAll=function(){return this.validator.validateAll()},c.prototype.saveContactForm=function(){return e(this,void 0,void 0,(function(){var e;return r(this,(function(r){switch(r.label){case 0:return e={isFormError:!1,isSuccess:!1},[4,this.validateAll()];case 1:if(r.sent())return e.isFormError=!0,[2,e];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,l.getInstance().customerStore.saveContactForm(t({firstName:this.model.firstName,lastName:this.model.lastName,email:this.model.email,message:this.model.message,referer:window.location.href},this.model.phone&&{phone:this.model.phone}))];case 3:return r.sent()&&(e.isSuccess=!0),[2,e];case 4:return r.sent(),[2,e];case 5:return[2]}}))}))},c}();export{c as ContactForm};

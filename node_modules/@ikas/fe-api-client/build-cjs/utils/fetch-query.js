"use strict";var e=require('../ext/tslib/tslib.es6.js'),r=require("axios"),n=require("../config/index.js"),a=require("./api.js"),t=require("../helpers/generate-return-fields.js");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=o(r),s=function(r){var o=r.operationName,u=r.variables,l=r.allReturnFields,R=r.fields,c=r.query,d=r.config;return e.__awaiter(void 0,void 0,void 0,(function(){var r,E,O,_,f,p,N,v,g;return e.__generator(this,(function(h){switch(h.label){case 0:return r=R?t.generateGqlReturnFields(R):l,E=d?{URL:d.URL||n.URL,TOKEN:d.TOKEN||n.TOKEN,HEADERS:d.HEADERS||n.HEADERS,ON_ERROR:d.ON_ERROR||n.ON_ERROR}:n,O={"Content-Type":"application/json"},E.TOKEN&&(O.authorization="Bearer ".concat(E.TOKEN)),[4,i.default.post(E.URL+"?op=".concat(o),{query:"string"==typeof c?c:c(r),variables:e.__assign({},u)},{headers:e.__assign(e.__assign({},O),E.HEADERS)})];case 1:return _=h.sent(),f=_.data.errors,0!==(p=new a.APIResponse(void 0,f)).errorCodes.length&&E.ON_ERROR?(N=!1,E.ON_ERROR.operations&&E.ON_ERROR.operations.length&&(v=null===(g=E.ON_ERROR.operations)||void 0===g?void 0:g.find((function(e){return e.operationName===o})))?[4,v.callback({graphQLErrors:f,operationName:o})]:[3,3]):[3,7];case 2:h.sent(),v.refreshQuery&&(N=!0),h.label=3;case 3:return E.ON_ERROR.errorCodes&&E.ON_ERROR.errorCodes.length?[4,Promise.all(p.errorCodes.map((function(r){return e.__awaiter(void 0,void 0,void 0,(function(){var n,a;return e.__generator(this,(function(e){switch(e.label){case 0:return(n=null===(a=E.ON_ERROR.errorCodes)||void 0===a?void 0:a.find((function(e){return e.errorCode===r})))?(N=N||!!n.refreshQuery,[4,n.callback({graphQLErrors:f,operationName:o})]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))})))]:[3,5];case 4:h.sent(),h.label=5;case 5:return N?[4,s({operationName:o,variables:u,allReturnFields:l,fields:R,query:c,config:d})]:[3,7];case 6:return[2,h.sent()];case 7:return[2,_.data]}}))}))};module.exports=s;
